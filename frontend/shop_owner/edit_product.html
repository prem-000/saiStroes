<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Product</title>

    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/shop_owner.css" />
</head>

<body>

    <nav class="topbar">
        <h2>Edit Product</h2>

        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="orders.html">Orders</a>
            <a href="my_products.html">My Products</a>
            <a href="add_product.html">Add Product</a>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <section class="form-wrapper">
        <form id="editProductForm" class="form-card">

            <label>Product Title</label>
            <input type="text" id="title" required />

            <label>Description</label>
            <textarea id="description"></textarea>

            <label>Price</label>
            <input type="number" id="price" required />

            <label>Stock</label>
            <input type="number" id="stock" required />

            <label>Category</label>
            <input type="text" id="category" placeholder="fruits / dairy / snacks etc" />

            <label>Image URL</label>
            <input type="text" id="image" />

            <button class="btn-primary" type="submit">Update Product</button>
        </form>
    </section>

    <script type="module">
        import { API_BASE } from "../js/api.js";

        const editId = new URLSearchParams(window.location.search).get("id");
        const token = localStorage.getItem("shop_owner_token");

        async function loadProduct() {
            if (!token) return alert("Login required");

            const res = await fetch(API_BASE + "/shop-owner/products/my", {
                headers: { Authorization: "Bearer " + token }
            });

            const products = await res.json();
            const p = products.find(x => x.id === editId);

            if (!p) return alert("Product not found");

            document.getElementById("title").value = p.title;
            document.getElementById("description").value = p.description;
            document.getElementById("price").value = p.price;
            document.getElementById("stock").value = p.stock;
            document.getElementById("category").value = p.category || "";
            document.getElementById("image").value = p.image || "";
        }

        loadProduct();

        document.getElementById("editProductForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const payload = {
                title: title.value,
                description: description.value,
                price: Number(price.value),
                stock: Number(stock.value),
                category: category.value.trim().toLowerCase(),
                image: image.value
            };

            const res = await fetch(API_BASE + `/shop-owner/products/${editId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: "Bearer " + token
                },
                body: JSON.stringify(payload)
            });

            const data = await res.json();
            if (!res.ok) return alert(data.detail || "Failed to update");

            alert("Updated successfully");
            window.location.href = "my_products.html";
        });
    </script>

</body>
</html>
